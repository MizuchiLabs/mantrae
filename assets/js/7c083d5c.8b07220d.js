"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[420],{2745:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"usage/agents","title":"Agents","description":"Agents in Mantrae extend your Traefik setup by enabling automatic configuration discovery from remote Docker hosts. Instead of manually defining routers in the web UI, you can label your containers with standard Traefik labels, and the agent will automatically synchronize this information with your Mantrae server.","source":"@site/docs/usage/agents.md","sourceDirName":"usage","slug":"/usage/agents","permalink":"/mantrae/usage/agents","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"DNS Providers","permalink":"/mantrae/usage/dns"},"next":{"title":"Environment Variables","permalink":"/mantrae/usage/environment"}}');var a=t(6070),r=t(7168);const s={sidebar_position:4},o="Agents",l={},c=[{value:"How Agents Work",id:"how-agents-work",level:2},{value:"Setting Up an Agent",id:"setting-up-an-agent",level:2},{value:"Step 1: Create an Agent in Mantrae",id:"step-1-create-an-agent-in-mantrae",level:3},{value:"Step 2: Copy the Agent Token",id:"step-2-copy-the-agent-token",level:3},{value:"Step 3: Deploy the Agent",id:"step-3-deploy-the-agent",level:3},{value:"Option 1: Direct Binary Execution",id:"option-1-direct-binary-execution",level:4},{value:"Option 2: Docker Run",id:"option-2-docker-run",level:4},{value:"Option 3: Docker Compose",id:"option-3-docker-compose",level:4},{value:"Using Traefik Labels with Agents",id:"using-traefik-labels-with-agents",level:2},{value:"Example HTTP Service",id:"example-http-service",level:3},{value:"Agent Configuration Options",id:"agent-configuration-options",level:2},{value:"Network Configuration",id:"network-configuration",level:2},{value:"Monitoring Agent Status",id:"monitoring-agent-status",level:2},{value:"Security Considerations",id:"security-considerations",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"agents",children:"Agents"})}),"\n",(0,a.jsx)(n.p,{children:"Agents in Mantrae extend your Traefik setup by enabling automatic configuration discovery from remote Docker hosts. Instead of manually defining routers in the web UI, you can label your containers with standard Traefik labels, and the agent will automatically synchronize this information with your Mantrae server."}),"\n",(0,a.jsx)(n.h2,{id:"how-agents-work",children:"How Agents Work"}),"\n",(0,a.jsx)(n.p,{children:"An agent is a lightweight binary that runs on any machine where you want to manage Docker containers. Each agent:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Discovers Docker containers and their Traefik labels on the local machine"}),"\n",(0,a.jsx)(n.li,{children:"Communicates with the Mantrae server to synchronize container information"}),"\n",(0,a.jsx)(n.li,{children:"Automatically creates routers, services, and middlewares based on container labels"}),"\n",(0,a.jsx)(n.li,{children:"Updates the Mantrae server when containers are added, removed, or changed"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"setting-up-an-agent",children:"Setting Up an Agent"}),"\n",(0,a.jsx)(n.h3,{id:"step-1-create-an-agent-in-mantrae",children:"Step 1: Create an Agent in Mantrae"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Log into the Mantrae web interface"}),"\n",(0,a.jsx)(n.li,{children:'Navigate to the "Agents" section'}),"\n",(0,a.jsx)(n.li,{children:'Click "Add Agent"'}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"step-2-copy-the-agent-token",children:"Step 2: Copy the Agent Token"}),"\n",(0,a.jsx)(n.p,{children:"After creating the agent, you'll see a configuration section with:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Agent Token (automatically generated)"}),"\n",(0,a.jsx)(n.li,{children:"Docker Run command"}),"\n",(0,a.jsx)(n.li,{children:"Docker Compose configuration"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Copy the agent token for the next step."}),"\n",(0,a.jsx)(n.h3,{id:"step-3-deploy-the-agent",children:"Step 3: Deploy the Agent"}),"\n",(0,a.jsx)(n.p,{children:"You can run the agent in several ways:"}),"\n",(0,a.jsx)(n.h4,{id:"option-1-direct-binary-execution",children:"Option 1: Direct Binary Execution"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Download the agent binary for your platform from the ",(0,a.jsx)(n.a,{href:"https://github.com/mizuchilabs/mantrae/releases",children:"releases page"})]}),"\n",(0,a.jsxs)(n.li,{children:["Run the agent with the token:","\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"TOKEN=YOUR_AGENT_TOKEN HOST=https://mantrae.example.com ./mantrae-agent\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"option-2-docker-run",children:"Option 2: Docker Run"}),"\n",(0,a.jsx)(n.p,{children:"Use the pre-generated Docker run command from the agent configuration page:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n    --name mantrae-agent \\\n    -e TOKEN=YOUR_AGENT_TOKEN \\\n    -e HOST=https://mantrae.example.com \\\n    -v /var/run/docker.sock:/var/run/docker.sock:ro \\\n    ghcr.io/mizuchilabs/mantrae-agent:latest\n"})}),"\n",(0,a.jsx)(n.h4,{id:"option-3-docker-compose",children:"Option 3: Docker Compose"}),"\n",(0,a.jsx)(n.p,{children:"Use the pre-generated Docker Compose configuration:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"services:\n  mantrae-agent:\n    image: ghcr.io/mizuchilabs/mantrae-agent:latest\n    container_name: mantrae-agent\n    network_mode: host\n    environment:\n      - TOKEN=YOUR_AGENT_TOKEN\n      - HOST=https://mantrae.example.com\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n    restart: unless-stopped\n"})}),"\n",(0,a.jsx)(n.h2,{id:"using-traefik-labels-with-agents",children:"Using Traefik Labels with Agents"}),"\n",(0,a.jsx)(n.p,{children:"Once the agent is running, you can label your containers as you normally would with Traefik. The agent will automatically collect these labels and synchronize them with the Mantrae server."}),"\n",(0,a.jsx)(n.h3,{id:"example-http-service",children:"Example HTTP Service"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'services:\n  whoami:\n    image: containous/whoami:latest\n    ports:\n      - "80:80"\n    labels:\n      - "traefik.enable=true"\n      - "traefik.http.routers.whoami.rule=Host(`whoami.example.com`)"\n      - "traefik.http.routers.whoami.entrypoints=websecure"\n      - "traefik.http.routers.whoami.tls=true"\n      - "traefik.http.services.whoami.loadbalancer.server.port=80"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"agent-configuration-options",children:"Agent Configuration Options"}),"\n",(0,a.jsx)(n.p,{children:"The agent supports several environment variables for configuration:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Variable"}),(0,a.jsx)(n.th,{children:"Description"}),(0,a.jsx)(n.th,{children:"Default"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"TOKEN"})}),(0,a.jsx)(n.td,{children:"Agent token from Mantrae server"}),(0,a.jsx)(n.td,{children:"Required"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"HOST"})}),(0,a.jsx)(n.td,{children:"Mantrae server URL"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.a,{href:"http://localhost:3000",children:"http://localhost:3000"})})]})]})]}),"\n",(0,a.jsx)(n.h2,{id:"network-configuration",children:"Network Configuration"}),"\n",(0,a.jsx)(n.p,{children:"Agents can automatically detect their network configuration:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Public IP Detection"}),": Agents will automatically detect their public IP address"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Private Network"}),": For internal networks, agents can use their private IP"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Manual Override"}),": You can manually specify the IP address that should be used for services"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"This information is visible in the agent details page in the Mantrae web interface."}),"\n",(0,a.jsx)(n.h2,{id:"monitoring-agent-status",children:"Monitoring Agent Status"}),"\n",(0,a.jsx)(n.p,{children:"In the Mantrae web interface, you can:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"View the status of all agents (online/offline)"}),"\n",(0,a.jsx)(n.li,{children:"See when each agent last synchronized"}),"\n",(0,a.jsx)(n.li,{children:"View the containers discovered by each agent"}),"\n",(0,a.jsx)(n.li,{children:"Rotate agent tokens for security"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Each agent has a unique token that should be kept secret"}),"\n",(0,a.jsx)(n.li,{children:"Tokens can be rotated at any time from the web interface"}),"\n",(0,a.jsx)(n.li,{children:"Agents only need read-only access to the Docker socket"}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},7168:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(758);const a={},r=i.createContext(a);function s(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);