syntax = "proto3";

package mantrae.v1;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";

service DNSProviderService {
  rpc GetDNSProvider(GetDNSProviderRequest) returns (GetDNSProviderResponse) {
    option idempotency_level = NO_SIDE_EFFECTS;
  }
  rpc CreateDNSProvider(CreateDNSProviderRequest) returns (CreateDNSProviderResponse);
  rpc UpdateDNSProvider(UpdateDNSProviderRequest) returns (UpdateDNSProviderResponse);
  rpc DeleteDNSProvider(DeleteDNSProviderRequest) returns (DeleteDNSProviderResponse);
  rpc ListDNSProviders(ListDNSProvidersRequest) returns (ListDNSProvidersResponse) {
    option idempotency_level = NO_SIDE_EFFECTS;
  }
}

enum DNSProviderType {
  DNS_PROVIDER_TYPE_UNSPECIFIED = 0;
  DNS_PROVIDER_TYPE_CLOUDFLARE = 1;
  DNS_PROVIDER_TYPE_POWERDNS = 2;
  DNS_PROVIDER_TYPE_TECHNITIUM = 3;
  DNS_PROVIDER_TYPE_PIHOLE = 4;
}

message DNSProvider {
  string id = 1;
  string name = 2;
  DNSProviderType type = 3;
  DNSProviderConfig config = 4;
  bool is_default = 5;
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

message DNSProviderConfig {
  string api_key = 1;
  string api_url = 2;
  string ip = 3;
  bool proxied = 4;
  bool auto_update = 5;
}

message GetDNSProviderRequest {
  string id = 1 [(buf.validate.field).string.min_len = 1];
}
message GetDNSProviderResponse {
  DNSProvider dns_provider = 1;
}

message CreateDNSProviderRequest {
  string name = 1 [(buf.validate.field).string.min_len = 1];
  DNSProviderType type = 2 [(buf.validate.field).enum.defined_only = true];
  DNSProviderConfig config = 3;
  bool is_default = 4;
}
message CreateDNSProviderResponse {
  DNSProvider dns_provider = 1;
}

message UpdateDNSProviderRequest {
  string id = 1 [(buf.validate.field).string.min_len = 1];
  string name = 2 [(buf.validate.field).string.min_len = 1];
  DNSProviderType type = 3 [(buf.validate.field).enum.defined_only = true];
  DNSProviderConfig config = 4;
  bool is_default = 5;
}
message UpdateDNSProviderResponse {
  DNSProvider dns_provider = 1;
}

message DeleteDNSProviderRequest {
  string id = 1 [(buf.validate.field).string.min_len = 1];
}
message DeleteDNSProviderResponse {}

message ListDNSProvidersRequest {
  optional int64 limit = 1 [(buf.validate.field).cel = {
    id: "limit.valid"
    message: "limit must be either -1 or greater than 0"
    expression: "this == -1 || this > 0"
  }];
  optional int64 offset = 2 [(buf.validate.field).int64.gte = 0];
}
message ListDNSProvidersResponse {
  repeated DNSProvider dns_providers = 1;
  int64 total_count = 2;
}
